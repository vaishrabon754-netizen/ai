<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shorkari Bench</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0c0c0c, #1a1a2e);
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* RGB Background Animation */
        .rgb-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
        }

        .rgb-light {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            animation: float 6s ease-in-out infinite;
        }

        .light-1 {
            width: 300px;
            height: 300px;
            background: #ff0080;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .light-2 {
            width: 400px;
            height: 400px;
            background: #00ff88;
            top: 60%;
            left: 80%;
            animation-delay: 2s;
        }

        .light-3 {
            width: 350px;
            height: 350px;
            background: #0080ff;
            top: 80%;
            left: 20%;
            animation-delay: 4s;
        }

        .light-4 {
            width: 250px;
            height: 250px;
            background: #ffaa00;
            top: 20%;
            left: 70%;
            animation-delay: 1s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px) scale(1);
                opacity: 0.6;
            }
            50% {
                transform: translateY(-40px) scale(1.1);
                opacity: 0.8;
            }
        }

        /* Pulsing Glow Effect */
        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
            }
            50% {
                box-shadow: 0 0 40px rgba(255, 255, 255, 0.2);
            }
        }

        /* Chat Container with Glass Effect */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            margin-top: 10px;
            margin-bottom: 10px;
            animation: pulse-glow 4s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .chat-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                #ff0080, #00ff88, #0080ff, #ffaa00);
            animation: rgb-border 3s linear infinite;
        }

        @keyframes rgb-border {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Neon Header */
        .chat-header {
            padding: 25px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .chat-header h1 {
            font-size: 2.2em;
            background: linear-gradient(45deg, #ff0080, #00ff88, #0080ff, #ffaa00);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rgb-text 4s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        @keyframes rgb-text {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Messages with Neon Effects */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            padding: 20px;
            border-radius: 15px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
            position: relative;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .message:hover {
            transform: translateY(-2px);
        }

        .user-message {
            background: linear-gradient(135deg, rgba(255, 0, 128, 0.2), rgba(0, 255, 136, 0.2));
            align-self: flex-end;
            max-width: 75%;
            border: 1px solid rgba(255, 0, 128, 0.3);
            box-shadow: 0 5px 15px rgba(255, 0, 128, 0.2);
        }

        .bot-message {
            background: linear-gradient(135deg, rgba(0, 128, 255, 0.2), rgba(255, 170, 0, 0.2));
            align-self: flex-start;
            max-width: 75%;
            border: 1px solid rgba(0, 128, 255, 0.3);
            box-shadow: 0 5px 15px rgba(0, 128, 255, 0.2);
        }

        /* Input Area with RGB Effects */
        .chat-input-container {
            padding: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.3);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        #chat-input {
            flex: 1;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 16px;
            resize: none;
            min-height: 70px;
            max-height: 200px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        #chat-input:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            background: rgba(255, 255, 255, 0.08);
        }

        #chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* RGB Send Button */
        #send-button {
            padding: 18px 30px;
            background: linear-gradient(45deg, #ff0080, #00ff88, #0080ff);
            background-size: 300% 300%;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            animation: rgb-button 3s ease infinite;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        #send-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            animation-duration: 1s;
        }

        #send-button:active {
            transform: translateY(-1px);
        }

        #send-button:disabled {
            background: #666;
            animation: none;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }

        @keyframes rgb-button {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            padding: 20px;
            color: #00ff88;
            font-style: italic;
            text-align: center;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* RGB Dots Animation for Typing */
        .typing-dots {
            display: inline-block;
        }

        .typing-dots span {
            animation: typing-dot 1.4s ease-in-out infinite both;
            display: inline-block;
            margin: 0 2px;
        }

        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing-dot {
            0%, 80%, 100% { 
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% { 
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Language Selector */
        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .lang-btn.active {
            background: linear-gradient(45deg, #ff0080, #00ff88);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }

        /* Mode Selector */
        .mode-selector {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .mode-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background: linear-gradient(45deg, #0080ff, #ffaa00);
            box-shadow: 0 0 15px rgba(0, 128, 255, 0.3);
        }

        .mode-indicator {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 2px;
        }

        /* Hidden API elements */
        .api-key-input, .model-selector, .status-info {
            display: none;
        }

        /* Scrollbar Styling */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #ff0080, #00ff88);
            border-radius: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #ff0080, #0080ff);
        }

        .error-message {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.3), rgba(255, 0, 128, 0.3)) !important;
            border: 1px solid rgba(255, 0, 0, 0.5) !important;
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.2) !important;
        }

        .translation-note {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 5px;
            font-style: italic;
        }

        .offline-indicator {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 5px;
            font-style: italic;
            color: #00ff88;
        }
    </style>
</head>
<body>
    <!-- RGB Background Lights -->
    <div class="rgb-background">
        <div class="rgb-light light-1"></div>
        <div class="rgb-light light-2"></div>
        <div class="rgb-light light-3"></div>
        <div class="rgb-light light-4"></div>
    </div>

    <!-- Mode Selector -->
    <div class="mode-selector">
        <button class="mode-btn active" data-mode="online">üåê Online AI</button>
        <button class="mode-btn" data-mode="offline">üíª Offline AI</button>
        <div class="mode-indicator" id="mode-indicator">Using Online AI</div>
    </div>

    <!-- Language Selector -->
    <div class="language-selector">
        <button class="lang-btn active" data-lang="auto">Auto Translate</button>
        <button class="lang-btn" data-lang="en">English</button>
        <button class="lang-btn" data-lang="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</button>
        <button class="lang-btn" data-lang="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
        <button class="lang-btn" data-lang="zh">‰∏≠Êñá</button>
    </div>

    <!-- Hidden API elements -->
    <div class="api-key-input">
        <input type="text" id="api-key-input" placeholder="Enter your OpenRouter API key..." 
               value="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">
    </div>

    <div class="model-selector">
        <select id="model-select">
            <option value="deepseek/deepseek-chat">DeepSeek Chat</option>
        </select>
    </div>

    <div class="status-info" id="status-info"></div>

    <div class="chat-container">
        <div class="chat-header">
            <h1>‚ú® Shorkari Bench ‚ú®</h1>
        </div>
        
        <div class="chat-messages" id="chat-messages">
            <div class="message bot-message">
                Welcome to Shorkari Bench! üåü I'm your multilingual AI assistant. I can work both online and offline with full conversational capabilities! How can I help you today?
                <div class="offline-indicator">üí° Tip: Switch to Offline mode for instant responses without internet - same AI quality!</div>
            </div>
        </div>

        <div class="typing-indicator" id="typing-indicator">
            AI is thinking <span class="typing-dots"><span>.</span><span>.</span><span>.</span></span>
        </div>

        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <textarea 
                    id="chat-input" 
                    placeholder="Type your message in any language... üåà (Press Shift+Enter for new line, Enter to send)"
                    rows="1"
                ></textarea>
                <button id="send-button">Send üöÄ</button>
            </div>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const typingIndicator = document.getElementById('typing-indicator');
        const apiKeyInput = document.getElementById('api-key-input');
        const modelSelect = document.getElementById('model-select');
        const langButtons = document.querySelectorAll('.lang-btn');
        const modeButtons = document.querySelectorAll('.mode-btn');
        const modeIndicator = document.getElementById('mode-indicator');

        // OpenRouter API configuration
        const API_URL = 'https://openrouter.ai/api/v1/chat/completions';

        // Language settings
        let currentLang = 'auto';
        let currentMode = 'online';
        const languageNames = {
            'en': 'English',
            'bn': 'Bengali',
            'hi': 'Hindi', 
            'zh': 'Chinese',
            'auto': 'Auto Detect'
        };

        // Advanced Offline AI Response Generator
        class OfflineAI {
            constructor() {
                this.conversationHistory = [];
                this.responsePatterns = this.buildResponsePatterns();
            }

            buildResponsePatterns() {
                return {
                    // General conversation patterns
                    'greeting': [
                        "Hello! It's great to connect with you. I'm Shorkari Bench AI, ready to assist you with whatever you need. What's on your mind today?",
                        "Hi there! Wonderful to meet you. I'm here to help with any questions or tasks you might have. How can I assist you today?",
                        "Greetings! I'm Shorkari Bench, your AI assistant. I'm excited to help you with information, creativity, problem-solving, or just a friendly chat. What would you like to explore?"
                    ],
                    'question': [
                        "That's an interesting question! Based on my understanding, ",
                        "I appreciate you asking that. From what I know, ",
                        "Great question! Let me share some insights about that: ",
                        "I've been trained on various topics, and regarding your question: "
                    ],
                    'creative': [
                        "What a creative thought! Let me build on that idea: ",
                        "I love creative discussions! Here's my perspective: ",
                        "That's an imaginative approach! Considering your idea: "
                    ],
                    'technical': [
                        "From a technical standpoint, ",
                        "In terms of the technical aspects, ",
                        "Technically speaking, "
                    ],
                    'personal': [
                        "I understand where you're coming from. ",
                        "That's a thoughtful perspective. ",
                        "I appreciate you sharing that. "
                    ]
                };
            }

            generateResponse(userMessage) {
                const message = userMessage.toLowerCase();
                this.conversationHistory.push({ role: 'user', content: userMessage });

                // Analyze message type and generate contextual response
                let response = this.analyzeAndRespond(message, userMessage);
                
                this.conversationHistory.push({ role: 'assistant', content: response });
                return response;
            }

            analyzeAndRespond(message, originalMessage) {
                // Contextual response generation based on message content
                const words = message.split(' ');
                const messageLength = words.length;
                
                // Detect question patterns
                if (message.includes('?') || message.includes('what') || message.includes('how') || 
                    message.includes('why') || message.includes('when') || message.includes('where')) {
                    return this.generateQuestionResponse(originalMessage);
                }

                // Detect creative/opinion requests
                if (message.includes('think') || message.includes('opinion') || message.includes('idea') ||
                    message.includes('creative') || message.includes('imagine')) {
                    return this.generateCreativeResponse(originalMessage);
                }

                // Detect technical topics
                if (message.includes('code') || message.includes('program') || message.includes('tech') ||
                    message.includes('computer') || message.includes('software') || message.includes('algorithm')) {
                    return this.generateTechnicalResponse(originalMessage);
                }

                // Detect personal/emotional content
                if (message.includes('feel') || message.includes('emotion') || message.includes('personal') ||
                    message.includes('experience') || message.includes('life')) {
                    return this.generatePersonalResponse(originalMessage);
                }

                // Default intelligent response
                return this.generateDefaultResponse(originalMessage);
            }

            generateQuestionResponse(question) {
                const baseResponses = this.responsePatterns.question;
                const baseResponse = baseResponses[Math.floor(Math.random() * baseResponses.length)];
                
                // Extract key topics from question for contextual response
                const topics = this.extractTopics(question);
                const contextualInfo = this.getContextualInformation(topics);
                
                return baseResponse + contextualInfo + " However, I'd recommend verifying this information with additional sources for complete accuracy.";
            }

            generateCreativeResponse(message) {
                const baseResponses = this.responsePatterns.creative;
                const baseResponse = baseResponses[Math.floor(Math.random() * baseResponses.length)];
                
                return baseResponse + "I think this approach could lead to some interesting outcomes. The key would be to " + 
                       this.generateCreativeAdvice() + " What are your thoughts on moving forward with this?";
            }

            generateTechnicalResponse(message) {
                const baseResponses = this.responsePatterns.technical;
                const baseResponse = baseResponses[Math.floor(Math.random() * baseResponses.length)];
                
                return baseResponse + "there are several considerations to keep in mind. The most important factors would be " +
                       this.generateTechnicalConsiderations() + ". Would you like me to elaborate on any specific aspect?";
            }

            generatePersonalResponse(message) {
                const baseResponses = this.responsePatterns.personal;
                const baseResponse = baseResponses[Math.floor(Math.random() * baseResponses.length)];
                
                return baseResponse + "Many people find that " + this.generatePersonalInsight() + 
                       ". It's important to consider what feels right for your specific situation.";
            }

            generateDefaultResponse(message) {
                const topics = this.extractTopics(message);
                if (topics.length > 0) {
                    return `I understand you're mentioning ${topics.join(', ')}. That's quite interesting! ` +
                           `From my perspective, ${this.generateInsightfulComment(topics)} ` +
                           `What specific aspect of this would you like to explore further?`;
                }
                
                return "Thank you for sharing that! I'm here to assist you with information, ideas, or just to have a meaningful conversation. " +
                       "Could you tell me more about what you'd like to discuss or how I can help you today?";
            }

            extractTopics(message) {
                const commonTopics = ['technology', 'science', 'education', 'health', 'business', 'art', 
                                    'music', 'sports', 'travel', 'food', 'culture', 'history', 'future'];
                const foundTopics = commonTopics.filter(topic => 
                    message.toLowerCase().includes(topic)
                );
                return foundTopics.length > 0 ? foundTopics : ['your message'];
            }

            getContextualInformation(topics) {
                const knowledgeBase = {
                    'technology': "technology is rapidly evolving with new innovations in AI, blockchain, and quantum computing shaping our future.",
                    'science': "scientific discoveries continue to expand our understanding of the universe, from quantum physics to biological systems.",
                    'education': "education is transforming with digital learning platforms and personalized approaches becoming more prevalent.",
                    'health': "health and wellness approaches are increasingly focusing on preventive care and holistic well-being.",
                    'business': "modern business strategies emphasize adaptability, digital transformation, and sustainable practices.",
                    'art': "art continues to evolve with digital mediums and traditional forms coexisting and influencing each other.",
                    'music': "music creation and consumption are being revolutionized by technology while maintaining cultural significance.",
                    'sports': "sports combine physical excellence with strategic thinking and technological advancements in training.",
                    'travel': "travel experiences are blending physical exploration with digital connectivity and sustainable practices.",
                    'food': "culinary arts are experiencing a fusion of traditional techniques with innovative approaches and global influences.",
                    'culture': "cultural exchanges are accelerating in our interconnected world, creating rich diversity and shared experiences.",
                    'history': "historical perspectives help us understand current contexts and anticipate future developments.",
                    'future': "the future holds incredible potential with advancements in various fields shaping human civilization."
                };

                return topics.map(topic => knowledgeBase[topic] || `this topic involves many interesting aspects worth exploring.`).join(' ');
            }

            generateCreativeAdvice() {
                const advice = [
                    "explore multiple perspectives and consider unconventional approaches",
                    "balance innovation with practical implementation considerations",
                    "gather diverse inputs and iterate on your initial concepts",
                    "focus on the core value while remaining open to adaptation",
                    "combine traditional wisdom with contemporary insights"
                ];
                return advice[Math.floor(Math.random() * advice.length)];
            }

            generateTechnicalConsiderations() {
                const considerations = [
                    "scalability, security, and user experience",
                    "performance optimization, maintainability, and future-proofing",
                    "integration capabilities, data management, and accessibility",
                    "system architecture, error handling, and documentation",
                    "compatibility, testing strategies, and deployment processes"
                ];
                return considerations[Math.floor(Math.random() * considerations.length)];
            }

            generatePersonalInsight() {
                const insights = [
                    "taking time for reflection often brings clarity to complex situations",
                    "balancing different aspects of life leads to more sustainable happiness",
                    "open communication and understanding are foundations of strong relationships",
                    "continuous learning and adaptation are key to personal growth",
                    "setting clear intentions while remaining flexible creates positive outcomes"
                ];
                return insights[Math.floor(Math.random() * insights.length)];
            }

            generateInsightfulComment(topics) {
                const comments = [
                    "this area has seen significant developments recently that might interest you",
                    "there are multiple perspectives worth considering on this subject",
                    "this topic connects to broader trends that are shaping our world",
                    "understanding this can provide valuable insights for various applications",
                    "this field continues to evolve with exciting new possibilities emerging"
                ];
                return comments[Math.floor(Math.random() * comments.length)];
            }
        }

        // Initialize Offline AI
        const offlineAI = new OfflineAI();

        function updateMode(mode) {
            currentMode = mode;
            
            // Update active button
            modeButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });

            // Update mode indicator
            modeIndicator.textContent = mode === 'online' ? 'Using Online AI' : 'Using Offline AI';

            // Update placeholder based on mode
            if (mode === 'online') {
                chatInput.placeholder = "Type your message in any language... üåà (Online Mode)";
            } else {
                chatInput.placeholder = "Type your message... üåà (Offline Mode - Full AI Capabilities)";
            }
        }

        function updateLanguage(lang) {
            currentLang = lang;
            
            // Update active button
            langButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });

            // Update placeholder based on language and mode
            if (currentMode === 'online') {
                if (lang === 'auto') {
                    chatInput.placeholder = "Type your message in any language... üåà (Online Mode)";
                } else {
                    const langName = languageNames[lang];
                    chatInput.placeholder = `Type your message in ${langName}... üåà (Online Mode)`;
                }
            }
        }

        function addMessage(content, isUser = false, isError = false, originalLanguage = null, isOffline = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'} ${isError ? 'error-message' : ''}`;
            
            let messageContent = content;
            if (originalLanguage && !isUser && !isError && currentMode === 'online') {
                messageContent += `\n<div class="translation-note">üîç Translated from ${languageNames[originalLanguage] || originalLanguage}</div>`;
            }
            if (isOffline && !isUser && !isError) {
                messageContent += `\n<div class="offline-indicator">üíª Offline AI Response</div>`;
            }
            
            messageDiv.innerHTML = messageContent;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            typingIndicator.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        // Simple language detection (basic)
        function detectLanguage(text) {
            const patterns = {
                'bn': /[\u0980-\u09FF]/, // Bengali
                'hi': /[\u0900-\u097F]/, // Hindi
                'zh': /[\u4e00-\u9fff]/, // Chinese
                'en': /^[a-zA-Z\s.,!?]+$/ // English (basic)
            };

            for (const [lang, pattern] of Object.entries(patterns)) {
                if (pattern.test(text)) {
                    return lang;
                }
            }
            return 'en'; // Default to English
        }

        function getTranslationPrompt(userMessage, targetLang) {
            if (targetLang === 'auto') {
                const detectedLang = detectLanguage(userMessage);
                if (detectedLang === 'en') {
                    return "Please respond in English.";
                } else {
                    return `Please detect the language of this message and respond in the same language. If the message is in ${languageNames[detectedLang]}, please respond in ${languageNames[detectedLang]}.`;
                }
            } else {
                return `Please respond in ${languageNames[targetLang]} language only.`;
            }
        }

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, true);
            chatInput.value = '';
            sendButton.disabled = true;

            // Show typing indicator
            showTypingIndicator();

            try {
                if (currentMode === 'online') {
                    // Online mode - use API
                    const apiKey = apiKeyInput.value.trim();
                    if (!apiKey) {
                        throw new Error('Please enter your OpenRouter API key first!');
                    }

                    const translationPrompt = getTranslationPrompt(message, currentLang);
                    const fullMessage = `${message}\n\n${translationPrompt}`;

                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'HTTP-Referer': window.location.origin || 'https://localhost',
                            'X-Title': 'Shorkari Bench',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            "model": modelSelect.value,
                            "messages": [
                                {
                                    "role": "user",
                                    "content": fullMessage
                                }
                            ],
                            "max_tokens": 2048
                        })
                    });

                    if (!response.ok) {
                        let errorMessage = `API Error: ${response.status}`;
                        
                        try {
                            const errorData = await response.json();
                            errorMessage += ` - ${errorData.error?.message || errorData.error?.type || response.statusText}`;
                        } catch (e) {
                            errorMessage += ` - ${response.statusText}`;
                        }

                        throw new Error(errorMessage);
                    }

                    const data = await response.json();
                    
                    if (data.choices && data.choices.length > 0 && data.choices[0].message) {
                        const botResponse = data.choices[0].message.content;
                        hideTypingIndicator();
                        
                        // Detect if the response was translated
                        const detectedLang = detectLanguage(message);
                        const showTranslationNote = currentLang === 'auto' && detectedLang !== 'en';
                        
                        addMessage(botResponse, false, false, showTranslationNote ? detectedLang : null, false);
                    } else {
                        throw new Error('Invalid response format from API');
                    }
                } else {
                    // Offline mode - use advanced local AI
                    // Simulate processing time (shorter since it's local)
                    setTimeout(() => {
                        const botResponse = offlineAI.generateResponse(message);
                        hideTypingIndicator();
                        addMessage(botResponse, false, false, null, true);
                        sendButton.disabled = false;
                        chatInput.focus();
                    }, 800);
                    return;
                }

            } catch (error) {
                hideTypingIndicator();
                addMessage(`Error: ${error.message}`, false, true);
                console.error('Error:', error);
            } finally {
                if (currentMode === 'online') {
                    sendButton.disabled = false;
                    chatInput.focus();
                }
            }
        }

        // Event listeners
        sendButton.addEventListener('click', sendMessage);

        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Language switch
        langButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                updateLanguage(btn.dataset.lang);
            });
        });

        // Mode switch
        modeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                updateMode(btn.dataset.mode);
            });
        });

        // Auto-resize textarea
        chatInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Focus on input when page loads
        chatInput.focus();

        // Add some initial animation to the chat container
        setTimeout(() => {
            document.querySelector('.chat-container').style.transform = 'scale(1)';
            document.querySelector('.chat-container').style.opacity = '1';
        }, 100);
    </script>
</body>
</html>
